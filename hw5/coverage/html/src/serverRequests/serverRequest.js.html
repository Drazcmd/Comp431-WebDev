<!doctype html>
<html lang="en">
<head>
    <title>Code coverage report for src/serverRequests/serverRequest.js</title>
    <meta charset="utf-8" />
    <link rel="stylesheet" href="../../prettify.css" />
    <link rel="stylesheet" href="../../base.css" />
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <style type='text/css'>
        .coverage-summary .sorter {
            background-image: url(../../sort-arrow-sprite.png);
        }
    </style>
</head>
<body>
<div class='wrapper'>
  <div class='pad1'>
    <h1>
      <a href="../../index.html">all files</a> / <a href="index.html">src/serverRequests/</a> serverRequest.js
    </h1>
    <div class='clearfix'>
      <div class='fl pad1y space-right2'>
        <span class="strong">34.48% </span>
        <span class="quiet">Statements</span>
        <span class='fraction'>20/58</span>
      </div>
      <div class='fl pad1y space-right2'>
        <span class="strong">62.5% </span>
        <span class="quiet">Branches</span>
        <span class='fraction'>10/16</span>
      </div>
      <div class='fl pad1y space-right2'>
        <span class="strong">20% </span>
        <span class="quiet">Functions</span>
        <span class='fraction'>3/15</span>
      </div>
      <div class='fl pad1y space-right2'>
        <span class="strong">31.91% </span>
        <span class="quiet">Lines</span>
        <span class='fraction'>15/47</span>
      </div>
      <div class='fl pad1y'>
        <span class="strong">1 branch</span>
        <span class="quiet">Ignored</span>  &nbsp;&nbsp;&nbsp;&nbsp;
      </div>
    </div>
  </div>
  <div class='status-line low'></div>
<pre><table class="coverage">
<tr><td class="line-count quiet">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94
95
96
97
98
99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131
132
133
134</td><td class="line-coverage quiet"><span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-yes">9×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">9×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">9×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">9×</span>
<span class="cline-any cline-yes">2×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">7×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span></td><td class="text"><pre class="prettyprint lang-js"><span class="cstat-no" title="statement not covered" ><span class="cstat-no" title="statement not covered" ><span class="cstat-no" title="statement not covered" ><span class="cstat-no" title="statement not covered" ><span class="cstat-no" title="statement not covered" ><span class="cstat-no" title="statement not covered" ><span class="fstat-no" title="function not covered" ><span class="branch-1 cbranch-no" title="branch not covered" >/</span></span></span></span></span></span></span></span>/turns out you CANNOT do "import fetch from 'node-fetch'" - it
//imports some stuff that wrecks how the cookies work :/
//require('isomorphic-fetch');
import fetch from 'node-fetch'
/**
'Dummy' as in the dummy server at the url below;
this is a real http request.
*/
const url = 'https://webdev-dummy.herokuapp.com'
/**
See the provided code for connecting to the dummy server
(https://jsbin.com/jeliroluni/edit?js,output)
*/
&nbsp;
export const resource = (method, endpoint, payload) =&gt; {
  const options =  {
    method,
    credentials: 'include',
    headers: {
      'Content-Type': 'application/json'
    }
  }
  if (payload) options.body = JSON.stringify(payload)
&nbsp;
  return fetch(`${url}/${endpoint}`, options)
    .then(r =&gt; {
      if (r.status === 200) {
        r</span>eturn (r.headers.get('Content-Type').indexOf('json') &gt; 0) ? r.json() : <span class="branch-1 cbranch-no" title="branch not covered" >r.text()
      } else {
        throw new Error(r.statusText)
      }
    })
}
export const getMainData = <span class="fstat-no" title="function not covered" >(userList) =&gt; {</span>
  const <span class="cstat-no" title="statement not covered" >userListStr = userList.join(',')</span>
    return <span class="cstat-no" title="statement not covered" >Promise.all([</span>
        resource('GET', 'articles'),
        resource('GET', `headlines/${userListStr}`),
        resource('GET', `avatars/${userListStr}`),
        //this one is to get our own headline!
        resource('GET', `headlines`)
    ]).then(<span class="fstat-no" title="function not covered" >getRequests =&gt; {</span>
        const <span class="cstat-no" title="statement not covered" >articles = getRequests[0].articles</span>
&nbsp;
        //we need to package each followee up for my components to use
        const <span class="cstat-no" title="statement not covered" >followeesHeadlines = getRequests[1].headlines</span>
        const <span class="cstat-no" title="statement not covered" >followeesAvatars = getRequests[2].avatars</span>
        const <span class="cstat-no" title="statement not covered" >followees = followeesHeadlines.map(<span class="fstat-no" title="function not covered" >(followeeWithHeadline) =&gt; {</span></span>
            const <span class="cstat-no" title="statement not covered" >headline = followeeWithHeadline.headline</span>
            const <span class="cstat-no" title="statement not covered" >username = followeeWithHeadline.username</span>
            const <span class="cstat-no" title="statement not covered" >possibleAvatar = followeesAvatars.find(<span class="fstat-no" title="function not covered" >(followee) =&gt; {</span></span>
                return <span class="cstat-no" title="statement not covered" >followee.username === username</span>
            })
            const <span class="cstat-no" title="statement not covered" >avatar = possibleAvatar ? possibleAvatar.avatar : null</span>
            return <span class="cstat-no" title="statement not covered" >{ </span>
                name: username,
                status: headline,
                img: avatar
            }
        })
        //response is like {headlines: [{username: cmd11, headline: "woo!"}]}
        const <span class="cstat-no" title="statement not covered" >ourHeadline = getRequests[3].headlines[0].headline</span>
        const <span class="cstat-no" title="statement not covered" >ourUsername = getRequests[3].headlines[0].username</span>
        return <span class="cstat-no" title="statement not covered" >{</span>
            articles: articles,
            followees: followees,
            //the reducer will only update what we put in here
            profileData: {
              name: ourUsername,
              status: ourHeadline
            }
        }
    })
}
export const getProfileData = <span class="fstat-no" title="function not covered" >() =&gt; {</span>
    return <span class="cstat-no" title="statement not covered" >Promise.all([</span>
        resource('GET', 'email'),
        resource('GET', 'zipcode')
    ]).then(<span class="fstat-no" title="function not covered" >getRequests =&gt; {</span>
        const <span class="cstat-no" title="statement not covered" >email = getRequests[0].email</span>
        const <span class="cstat-no" title="statement not covered" >zipcode = getRequests[1].zipcode</span>
        return <span class="cstat-no" title="statement not covered" >{</span>
          profileData: {
              email: email,
              zipcode: zipcode
          }
       } 
    })
}
&nbsp;
/**  
These two can be used for updating any of the various user fields who are
updated using a PUT with endpoint as /${fieldname} and required payload as
{ ${fieldname}: value }.
&nbsp;
This includes the user's headline, user email,  zipcode, and password,
*/
const updateField = <span class="fstat-no" title="function not covered" >(field, value) =&gt; {</span>
  //unfortunately there's no way to functionally interpolate the
  //field variable as our key (rather than 'field' as the key) :(
  const <span class="cstat-no" title="statement not covered" >payload = {}</span>
  payload[<span class="cstat-no" title="statement not covered" >field] = value</span>
  return <span class="cstat-no" title="statement not covered" >resource('PUT', field, payload)</span>
}
export const updateFields = <span class="fstat-no" title="function not covered" >(fieldValueObjs) =&gt; {</span>
  const <span class="cstat-no" title="statement not covered" >resultingDataAcc = {}</span>
  return <span class="cstat-no" title="statement not covered" >Promise.all(</span>
    fieldValueObjs.map(<span class="fstat-no" title="function not covered" >fieldValueObj =&gt; {</span>
      //i.e. email, zipcode, headline, etc
      const <span class="cstat-no" title="statement not covered" >fieldToUpdate = fieldValueObj.field</span>
      //i.e. a@gmail.com, 33333, etc.
      const <span class="cstat-no" title="statement not covered" >newValue = fieldValueObj.value</span>
      return <span class="cstat-no" title="statement not covered" >updateField(fieldToUpdate, newValue)</span>
    })
  ).then(<span class="fstat-no" title="function not covered" >(fetchResponses) =&gt; {</span>
    return <span class="cstat-no" title="statement not covered" >fetchResponses.reduce(</span>
      (<span class="fstat-no" title="function not covered" >(resultingDataAcc, fetchResponse, index) =&gt; {</span>
        //Index should be the same due to use of Promise.all
        const <span class="cstat-no" title="statement not covered" >field = fieldValueObjs[index].field</span>
        //And now package it up nicely for our reducers to use
        const <span class="cstat-no" title="statement not covered" >withField = {</span>
          ...resultingDataAcc
        }
        //Same inability to interpolate as above :/ It's a
        //fundamental limitation of js as far as I understand
        withField[<span class="cstat-no" title="statement not covered" >field] = fetchResponse[field]</span>
        return <span class="cstat-no" title="statement not covered" >withField</span>
      })
    )
  })
}
&nbsp;
&nbsp;
&nbsp;</pre></td></tr>
</table></pre>
<div class='push'></div><!-- for sticky footer -->
</div><!-- /wrapper -->
<div class='footer quiet pad2 space-top1 center small'>
  Code coverage
  generated by <a href="http://istanbul-js.org/" target="_blank">istanbul</a> at Mon Mar 27 2017 23:54:53 GMT-0500 (CDT)
</div>
</div>
<script src="../../prettify.js"></script>
<script>
window.onload = function () {
        if (typeof prettyPrint === 'function') {
            prettyPrint();
        }
};
</script>
<script src="../../sorter.js"></script>
</body>
</html>
